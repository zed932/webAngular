<div class="admin-panel">
  <div class="panel-header">
    <h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏</h1>
    <button class="glass-button" (click)="startAddApp()" [disabled]="isEditing || isAdding">
      + –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    </button>
  </div>

  <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="stats-grid">
    <div class="stat-card glass-effect">
      <div class="stat-icon">üì±</div>
      <div class="stat-info">
        <h3>{{ stats.totalApps }}</h3>
        <p>–í—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</p>
      </div>
    </div>
    <div class="stat-card glass-effect">
      <div class="stat-icon">üöÄ</div>
      <div class="stat-info">
        <h3>{{ stats.publishedApps }}</h3>
        <p>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</p>
      </div>
    </div>
    <div class="stat-card glass-effect">
      <div class="stat-icon">‚¨áÔ∏è</div>
      <div class="stat-info">
        <h3>{{ stats.totalDownloads }}</h3>
        <p>–í—Å–µ–≥–æ –∑–∞–≥—Ä—É–∑–æ–∫</p>
      </div>
    </div>
    <div class="stat-card glass-effect">
      <div class="stat-icon">‚≠ê</div>
      <div class="stat-info">
        <h3>{{ stats.averageRating }}</h3>
        <p>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥</p>
      </div>
    </div>
  </div>

  <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
  <div class="edit-form glass-effect" *ngIf="isAdding">
    <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h3>
    <div class="form-grid">
      <input [(ngModel)]="newApp.name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è" class="glass-input">
      <input [(ngModel)]="newApp.version" placeholder="–í–µ—Ä—Å–∏—è" class="glass-input">
      <input [(ngModel)]="newApp.minIOSVersion" placeholder="–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è iOS" class="glass-input">
      <input [(ngModel)]="newApp.icon" placeholder="–ò–∫–æ–Ω–∫–∞ (—ç–º–æ–¥–∑–∏)" class="glass-input">
      <textarea [(ngModel)]="newApp.description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" class="glass-input"></textarea>
      <div class="checkbox-group">
        <label>
          <input type="checkbox" [(ngModel)]="newApp.supportsMacOS"> –ü–æ–¥–¥–µ—Ä–∂–∫–∞ macOS
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="newApp.isPublished"> –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
        </label>
      </div>
    </div>
    <div class="form-actions">
      <button class="glass-button" (click)="saveNewApp()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button class="glass-button secondary" (click)="cancelAdd()">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

  <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
  <div class="edit-form glass-effect" *ngIf="isEditing && selectedApp">
    <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h3>
    <div class="form-grid">
      <input [(ngModel)]="selectedApp.name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" class="glass-input">
      <input [(ngModel)]="selectedApp.version" placeholder="–í–µ—Ä—Å–∏—è" class="glass-input">
      <input [(ngModel)]="selectedApp.minIOSVersion" placeholder="–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è iOS" class="glass-input">
      <input [(ngModel)]="selectedApp.icon" placeholder="–ò–∫–æ–Ω–∫–∞" class="glass-input">
      <textarea [(ngModel)]="selectedApp.description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" class="glass-input"></textarea>
      <input [(ngModel)]="selectedApp.downloadCount" type="number" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≥—Ä—É–∑–æ–∫" class="glass-input">
      <input [(ngModel)]="selectedApp.rating" type="number" step="0.1" min="0" max="5" placeholder="–†–µ–π—Ç–∏–Ω–≥" class="glass-input">

      <div class="tech-stack-section">
        <label>–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:</label>
        <div class="tech-stack-input">
          <input [(ngModel)]="newTechStackItem" placeholder="–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é" class="glass-input"
                 (keyup.enter)="addTechStackItem()">
          <button class="glass-button small" (click)="addTechStackItem()">+</button>
        </div>
        <div class="tech-stack-list">
          <span *ngFor="let tech of selectedApp.techStack; let i = index" class="tech-tag">
            {{ tech }}
            <button (click)="removeTechStackItem(i)" class="remove-tech">√ó</button>
          </span>
        </div>
      </div>

      <div class="checkbox-group">
        <label>
          <input type="checkbox" [(ngModel)]="selectedApp.supportsMacOS"> –ü–æ–¥–¥–µ—Ä–∂–∫–∞ macOS
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="selectedApp.isPublished"> –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
        </label>
      </div>
    </div>
    <div class="form-actions">
      <button class="glass-button" (click)="saveApp()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button class="glass-button secondary" (click)="cancelEdit()">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π -->
  <div class="apps-list">
    <div *ngFor="let app of apps" class="app-card glass-effect" [class.publishing]="getPublishStatus(app._id)">

      <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ -->
      <div *ngIf="getPublishStatus(app._id)" class="publish-progress-container">
        <div class="publish-progress-info">
          <span class="publish-message">{{ getPublishStatus(app._id)?.message }}</span>
          <span class="publish-percentage">{{ getPublishStatus(app._id)?.progress }}%</span>
        </div>
        <div class="publish-progress-bar">
          <div class="progress-fill" [style.width.%]="getPublishStatus(app._id)?.progress || 0"></div>
        </div>
        <div class="publish-status-icon">
          <span *ngIf="getPublishStatus(app._id)?.status === 'publishing'">üîÑ</span>
          <span *ngIf="getPublishStatus(app._id)?.status === 'success'" class="success">‚úÖ</span>
          <span *ngIf="getPublishStatus(app._id)?.status === 'error'" class="error">‚ùå</span>
        </div>
      </div>

      <div class="app-header">
        <div class="app-icon">{{ app.icon }}</div>
        <div class="app-info">
          <h3>{{ app.name }}</h3>
          <p class="app-version">v{{ app.version }}</p>
          <p class="app-description">{{ app.description }}</p>
        </div>
        <div class="app-status" [class.published]="app.isPublished">
          {{ app.isPublished ? 'üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ' : 'üìù –ß–µ—Ä–Ω–æ–≤–∏–∫' }}
        </div>
      </div>

      <div class="app-details">
        <div class="tech-stack">
          <span *ngFor="let tech of app.techStack" class="tech-tag">{{ tech }}</span>
        </div>
        <div class="app-metrics">
          <span>‚¨áÔ∏è {{ app.downloadCount }}</span>
          <span>‚≠ê {{ app.rating }}</span>
          <span>{{ app.minIOSVersion }}</span>
          <span *ngIf="app.supportsMacOS">üíª macOS</span>
        </div>
      </div>

      <div class="app-actions">
        <button class="glass-button small"
                (click)="togglePublish(app)"
                [disabled]="getPublishStatus(app._id)?.status === 'publishing'">
          {{ app.isPublished ? '–°–Ω—è—Ç—å —Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏' : '–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å' }}
        </button>
        <button class="glass-button small"
                (click)="editApp(app)"
                [disabled]="getPublishStatus(app._id)?.status === 'publishing'">
          –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        </button>
        <button class="glass-button small danger"
                (click)="deleteApp(app._id)"
                [disabled]="getPublishStatus(app._id)?.status === 'publishing'">
          –£–¥–∞–ª–∏—Ç—å
        </button>
      </div>
    </div>
  </div>
</div>
